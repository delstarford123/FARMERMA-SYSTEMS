{% extends "base.html" %}

{% block content %}
<div class="container py-5 overflow-hidden">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                {% for category, message in messages %}
                  <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show shadow-sm" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
                {% endfor %}
              {% endif %}
            {% endwith %}

            <div class="card shadow-lg border-0 mt-4 register-card border-top border-4" style="border-color: #2E7D32 !important;">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <h3 class="fw-bold register-title" style="color: #5D4037;">Create an Account</h3>
                        <p class="text-muted register-subtitle">Join Farmerman Systems to access exclusive market intelligence.</p>
                    </div>
                    
                    <form action="/register" method="POST"> 
                        <div class="mb-3 reg-field">
                            <label for="fullName" class="form-label fw-bold" style="color: #5D4037;">Full Name</label>
                            <input type="text" class="form-control form-control-lg" id="fullName" name="fullName" placeholder="Jane Doe" required>
                        </div>
                        
                        <div class="mb-3 reg-field">
                            <label for="email" class="form-label fw-bold" style="color: #5D4037;">Email Address</label>
                            <input type="email" class="form-control form-control-lg" id="email" name="email" placeholder="name@example.com" required>
                        </div>
                        
                        <div class="mb-3 reg-field">
                            <label for="organization" class="form-label fw-bold" style="color: #5D4037;">Organization / Farm Name <span class="text-muted fw-normal">(Optional)</span></label>
                            <input type="text" class="form-control form-control-lg" id="organization" name="organization" placeholder="e.g., Global Agribusiness Co.">
                        </div>

                        <div class="mb-4 reg-field">
                            <label for="password" class="form-label fw-bold" style="color: #5D4037;">Password</label>
                            <input type="password" class="form-control form-control-lg" id="password" name="password" required minlength="8">
                            <div class="form-text">Must be at least 8 characters long.</div>
                        </div>

                        <div class="form-check mb-4 reg-field">
                            <input class="form-check-input" type="checkbox" value="" id="termsCheck" required>
                            <label class="form-check-label small text-muted" for="termsCheck">
                                I agree to the <a href="/terms-of-service" class="text-decoration-none" style="color: #2E7D32;">Terms of Service</a> and <a href="/privacy-policy" class="text-decoration-none" style="color: #2E7D32;">Privacy Policy</a>.
                            </label>
                        </div>

                        <div class="d-grid reg-field">
                            <button type="submit" class="btn btn-lg fw-bold shadow-sm register-btn text-white" style="background-color: #2E7D32; border-color: #2E7D32;">Create Account & Continue</button>
                        </div>
                    </form>
                    
                    <div class="text-center mt-4 pt-3 border-top reg-field">
                        <p class="text-muted mb-0">Already have an account? <a href="/login" class="fw-bold text-decoration-none" style="color: #0288D1;">Sign in here</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Prevent visibility before animation */
    .register-card, .reg-field {
        opacity: 0;
    }
    .form-control:focus {
        border-color: #2E7D32;
        box-shadow: 0 0 0 0.25rem rgba(46, 125, 50, 0.25);
    }
</style>
{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<script>
    // 1. Flip-X Entrance for the Card
    gsap.to(".register-card", {
        rotationX: 0, 
        opacity: 1, 
        startAt: { rotationX: 90 },
        transformPerspective: 800, 
        duration: 1.2, 
        ease: "power3.out"
    });

    // 2. Cascade Reveal for Form Fields
    gsap.to(".reg-field", {
        y: 0,
        opacity: 1,
        startAt: { y: 20 },
        stagger: 0.1,
        duration: 0.6,
        ease: "power2.out",
        delay: 0.5
    });

    // 3. Magnetic Button Interaction
    const regBtn = document.querySelector(".register-btn");
    regBtn.addEventListener("mousemove", (e) => {
        const rect = regBtn.getBoundingClientRect();
        const x = e.clientX - rect.left - rect.width / 2;
        const y = e.clientY - rect.top - rect.height / 2;
        gsap.to(regBtn, { x: x * 0.3, y: y * 0.3, duration: 0.3 });
    });
    regBtn.addEventListener("mouseleave", () => {
        gsap.to(regBtn, { x: 0, y: 0, duration: 0.3 });
    });
</script>
{% endblock %}